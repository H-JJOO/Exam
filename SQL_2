-- Q1

DELIMITER $$
CREATE OR REPLACE PROCEDURE proc_INSERT_ORDER
(
	P_O_NO INT,
	P_CUS_NO INT,
	P_O_PRICE INTEGER
)
BEGIN	
	INSERT INTO t_order
	(o_no, cus_no, o_price)
	values
	(P_O_NO, P_CUS_NO,NOW(), P_O_PRICE);
END $$
DELIMITER ;

CALL proc_INSERT_ORDER(8, 6, 80000);

SELECT * FROM t_order;

DROP PROCEDURE if EXISTS proc_INSERT_ORDER;

-- Q2

DELIMITER $$
CREATE OR REPLACE FUNCTION fn_GET_AGE
(
	BIRTH_DATE CHAR(8)
) RETURNS INT
BEGIN
	RETURN DATE_FORMAT(NOW(), '%Y') - LEFT(BIRTH_DATE, 4) + 1;
END $$
DELIMITER ;

SELECT fn_GET_AGE('19871123');

DROP FUNCTION IF EXISTS fn_GET_AGE;

-- Q3

DELIMITER $$
CREATE TRIGGER trg_DEL_CUSTOMER
BEFORE DELETE ON t_customer
FOR EACH ROW
BEGIN 
	DELETE FROM t_order
	WHERE cus_no = OLD.cus_no;
END $$	
DELIMITER ; 

DELETE FROM t_customer
WHERE cus_no = 3;

DROP TRIGGER IF EXISTS trg_DEL_CUSTOMER;
